#!/usr/bin/env bash
# Amygdala post-tool-use hook for Claude Code
INPUT=$(cat)
TOOL_NAME=$(echo "$INPUT" | python -c "import sys,json; d=json.load(sys.stdin); print(d.get('tool_name',''))" 2>/dev/null)
FILE_PATH=$(echo "$INPUT" | python -c "import sys,json; d=json.load(sys.stdin); inp=d.get('tool_input',{}); print(inp.get('file_path', inp.get('path','')))" 2>/dev/null)

if [ "$TOOL_NAME" = "Write" ] || [ "$TOOL_NAME" = "Edit" ]; then
    if [ -n "$FILE_PATH" ]; then
        amygdala diff --mark-dirty "$FILE_PATH" --dir "{{ project_root }}" 2>/dev/null
    fi
fi
